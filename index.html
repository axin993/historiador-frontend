<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Historiador</title>
    <style>
      body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 2rem;
        background-color: #f7f7f7;
      }
      h1 {
        margin-bottom: 1rem;
      }
      #messageContainer {
        width: 90%;
        max-width: 600px;
        height: 80vh;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: white;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      .message {
        margin-bottom: 1rem;
      }
      .user {
        font-weight: bold;
        color: #0066cc;
      }
      .historiador {
        font-weight: bold;
        color: #cc0000;
      }
      #controls {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }
      #textInput {
        width: 90%;
        max-width: 600px;
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      #sendTextBtn {
        padding: 0.5rem 1rem;
        font-size: 1rem;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      #sendTextBtn:hover {
        background: #0056b3;
      }
      #micButton {
        background-color: #007bff;
        border: none;
        border-radius: 50%;
        padding: 1rem;
        cursor: pointer;
      }
      #micButton img {
        width: 24px;
        height: 24px;
      }
    </style>
  </head>
  <body>
    <h1>H - El historiador</h1>

    <div id="messageContainer"></div>

    <div id="controls">
      <!-- Microphone button -->
      <button id="micButton">
        <img src="https://img.icons8.com/ios-filled/50/ffffff/microphone.png" alt="Mic" />
      </button>

      <!-- Text input field -->
      <div style="display: flex; gap: 10px;">
        <input type="text" id="textInput" placeholder="Escribe tu argumento" />
        <button id="sendTextBtn">Enviar</button>
      </div>
    </div>

    <script>
      const messageContainer = document.getElementById("messageContainer");

      function addMessageToContainer(sender, message) {
        const div = document.createElement("div");
        div.classList.add("message");
        div.innerHTML = `<span class="${sender === 'Tú' ? 'user' : 'historiador'}">${sender}:</span> ${message}`;
        messageContainer.appendChild(div);
        messageContainer.scrollTop = messageContainer.scrollHeight;
      }

      // Text input handler
      document.getElementById("sendTextBtn").addEventListener("click", async () => {
        const input = document.getElementById("textInput");
        const text = input.value.trim();
        if (!text) return;

        addMessageToContainer("Tú", text);
        input.value = "";

        const response = await fetch("https://historiador-backend.onrender.com/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });

        const data = await response.json();
        addMessageToContainer("Historiador", data.response);
      });

      // Enter key handler
      document.getElementById("textInput").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          document.getElementById("sendTextBtn").click();
        }
      });

      // Microphone button handler (voice recognition)
      document.getElementById("micButton").addEventListener("click", async () => {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "es-ES";
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.onresult = async (event) => {
          const transcript = event.results[0][0].transcript;
          addMessageToContainer("Tú", transcript);

          const response = await fetch("https://historiador-backend.onrender.com/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: transcript })
          });

          const data = await response.json();
          addMessageToContainer("Historiador", data.response);
        };

        recognition.onerror = (event) => {
          alert("Error de reconocimiento de voz: " + event.error);
        };

        recognition.start();
      });
    </script>
  </body>
</html>
